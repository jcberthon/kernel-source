From: Masahiro Yamada <yamada.masahiro@socionext.com>
Date: Wed, 6 Jan 2016 13:25:10 +0900
Subject: clk: add clk_unregister_fixed_rate()
Git-commit: 0b225e41e369a7e03411bb67988513302a10382f
Patch-mainline: v4.6-rc1
References: bsc#1032150

Allow to unregister fixed rate clock.

Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
Signed-off-by: Stephen Boyd <sboyd@codeaurora.org>
Signed-off-by: Matthias Brugger <mbrugger@suse.com>
---
 drivers/clk/clk-fixed-rate.c |   13 +++++++++++++
 include/linux/clk-provider.h |    2 +-
 2 files changed, 14 insertions(+), 1 deletion(-)

--- a/drivers/clk/clk-fixed-rate.c
+++ b/drivers/clk/clk-fixed-rate.c
@@ -132,6 +132,19 @@ struct clk *clk_register_fixed_rate(stru
 }
 EXPORT_SYMBOL_GPL(clk_register_fixed_rate);
 
+void clk_unregister_fixed_rate(struct clk *clk)
+{
+	struct clk_hw *hw;
+
+	hw = __clk_get_hw(clk);
+	if (!hw)
+		return;
+
+	clk_unregister(clk);
+	kfree(to_clk_fixed_rate(hw));
+}
+EXPORT_SYMBOL_GPL(clk_unregister_fixed_rate);
+
 #ifdef CONFIG_OF
 /**
  * of_fixed_clk_setup() - Setup function for simple fixed rate clock
--- a/include/linux/clk-provider.h
+++ b/include/linux/clk-provider.h
@@ -292,6 +292,7 @@ struct clk *clk_register_fixed_rate_with
 struct clk *clk_register_fixed_rate_with_accuracy(struct device *dev,
 		const char *name, const char *parent_name, unsigned long flags,
 		unsigned long fixed_rate, unsigned long fixed_accuracy);
+void clk_unregister_fixed_rate(struct clk *clk);
 struct clk_hw *clk_hw_register_fixed_rate_with_accuracy(struct device *dev,
 		const char *name, const char *parent_name, unsigned long flags,
 		unsigned long fixed_rate, unsigned long fixed_accuracy);
